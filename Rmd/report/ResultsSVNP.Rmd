---
title: "Analyzing the results" 
author: "Michael Koch"
date: "07-03-2022"
output: html_document
---

# Working through the results of the Mini- (/ Pilot-) simulation for the SVNP
o
Note, I'm working in the Thesis folder for now to avoid merge conflicts and just overall github gezeik. 

# Step1: Prepearations

```{r, message = F, warning = F}
# load packages outside of simulation
library(papaja)
#source required functions & parameters
source('~/OneDrive/ms/thesis/R/functions.R')
source('~/OneDrive/ms/thesis/R/parameters.R')
```

```{r}
# load results
resultsSVNP <- read.csv("~/OneDrive/ms/thesis/output/resultsSVNP.csv", 
                        sep = " ", 
                        header = TRUE)
convSVNP <- read.csv("~/OneDrive/ms/thesis/output/convSVNP.csv",
                     sep = " ",
                     header = TRUE)
```

```{r, chache=T}
# inspect a bit
nrow(resultsSVNP)
```

```{r}
range(resultsSVNP$pos)
```

```{r}
length(resultsSVNP$pos) == length(unique(resultsSVNP$pos))
```

# Post-process

Arrange the data based on conditions and iteration, and add a sigma squared column:


```{r}
resultsSVNP <- 
  resultsSVNP %>% 
  arrange(sigma, N, cross, iteration) %>% 
  mutate(sigmaSqu = sigma^2)
```

## Convergence

Let's explore the convergence a bit


### Divergent transitions

Not a single divergent transition

```{r}
totalSumDiv <- sum(convSVNP$sumDiv)
totalSumDiv 
```

### Effective Sample Size

```{r}
  convSVNP %>% 
  filter(parameter == "n_eff") %>% 
  map_df(min)
```



Looking good as well. 

### R-Hat

```{r}
convSVNP %>% 
  filter(parameter == "Rhat") %>% 
  map_df(max) %>% 
  map_df(function(x){x < 1.01})

```

Not a single parameter where the MAXIMUM Rhat IS NOT < 1.005


### Max Treedepth

```{r}
convSVNP %>% 
  filter(parameter == "Rhat") %>% 
  select(maxTree) %>% 
  map_df(max) 
```

FF met Sara bespreken, maar dit is meer over efficientie dan validiteit van de output, dus het zit sws wel goed!


# Plots


## Bias Mean Estimates 

### Cross-Loadings

```{r}
resultsSVNP %>% 
  #filter(N == 100) %>% 
  select(biasCrossMean_1, cross) %>%
  group_by(as.factor(cross)) %>% 
  summarise(meanBiasCrossMean_1 = mean(biasCrossMean_1)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasCrossMean_1))+
  geom_point(shape = 3)+
  theme_apa()+
  labs(x = "Size True Cross Loading",
       y = "Mean (Absolute) Bias",
       title = "Mean (Absolute) Bias in Mean Estimate of Cross Loading 1")
```


```{r}
resultsSVNP %>% 
  #filter(N == 200) %>% 
  select(biasCrossMean_6, cross) %>%
  group_by(as.factor(cross)) %>% 
  summarise(meanBiasCrossMean_6 = mean(biasCrossMean_6)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasCrossMean_6))+
  geom_point(shape = 3)+
  theme_apa()+
  labs(x = "Size True Cross Loading",
       y = "Mean (Absolute) Bias",
       title = "Mean (Absolute) Bias in Mean Estimate of Cross Loading 6")
```

```{r, warning = F}
resultsSVNP %>% 
  select(biasCrossMean_1, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(cross, label) %>% 
  summarise(meanBiasCrossMean_1 = mean(biasCrossMean_1,)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasCrossMean_1))+
  geom_point(shape = 3)+
  facet_wrap(~label)+
  labs(x = "Size Cross Loading",
       y = "Mean Absolute Bias",
      title = "Mean Absolute Bias in Mean Estimate of Cross-Loading 1")+
  theme_apa()
```


```{r, warning = F}
resultsSVNP %>% 
  select(biasCrossMean_6, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(cross, label) %>% 
  summarise(meanBiasCrossMean_6 = mean(biasCrossMean_6,)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasCrossMean_6))+
  geom_point(shape = 3)+
  facet_wrap(~label)+
  labs(x = "Size Cross Loading",
       y = "Mean Absolute Bias",
      title = "Mean Absolute Bias in Mean Estimate of Cross-Loading 6")+
  theme_apa()
```

### Factor Correlation

```{r}
resultsSVNP %>% 
  #filter(N == 200) %>% 
  select(biasFactCorrMean, cross) %>%
  group_by(cross) %>% 
  summarise(meanBiasFactCorrMean = mean(biasFactCorrMean)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasFactCorrMean))+
  geom_point(shape = 3)+
  papaja::theme_apa()+
  labs(x = "Size True Cross Loadings",
       y = "Mean Absolute Bias",
       title = "Mean Absolute Bias in Mean Estimates Factor Correlation")
```

```{r, warning = F}
resultsSVNP %>% 
  select(biasFactCorrMean, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(cross, label) %>% 
  summarise(meanBiasFactCorrMean = mean(biasFactCorrMean,)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasFactCorrMean))+
  geom_point(shape = 3)+
  facet_wrap(~label)+
  labs(x = "Size Cross Loading",
       y = "Mean Absolute Bias",
      title = "Mean Absolute Bias in Mean Estimates Factor Correlation")+
  theme_apa()
```


### Main Loadings

```{r}
resultsSVNP %>% 
  select(biasMainMean_3, cross) %>%
  group_by(as.factor(cross)) %>% 
  summarise(meanBiasMain_3 = mean(biasMainMean_3)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasMain_3))+
  geom_point(shape = 3)+
  papaja::theme_apa()+
  labs(x = "Size Cross Loading",
       y = "Mean (Absolute) Bias",
       title = "Mean  Bias in Mean Estimates Main Loading 3" )
```


```{r}
resultsSVNP %>% 
  select(biasMainMean_4, cross) %>%
  group_by(as.factor(cross)) %>% 
  summarise(meanBiasMain_4 = mean(biasMainMean_4)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasMain_4))+
  geom_point(shape = 3)+
  papaja::theme_apa()+
  labs(x = "Size Cross Loading",
       y = "Mean (Absolute) Bias",
       title = "Mean  Bias in Mean Estimates Main Loading 4" )
```


```{r, warning = F}
resultsSVNP %>% 
  select(biasMainMean_3, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(cross, label) %>% 
  summarise(meanBiasMainMean_3 = mean(biasMainMean_3)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasMainMean_3))+
  geom_point(shape = 3)+
  facet_wrap(~label)+
  labs(x = "Size Cross Loading",
       y = "Mean Absolute Bias",
      title = "Mean Absolute Bias in Mean Estimates Main Loading 3")+
  theme_apa()
```

```{r, warning = F}
resultsSVNP %>% 
  select(biasMainMean_4, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(cross, label) %>% 
  summarise(meanBiasMainMean_4 = mean(biasMainMean_4)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasMainMean_4))+
  geom_point(shape = 3)+
  facet_wrap(~label)+
  labs(x = "Size Cross Loading",
       y = "Mean Absolute Bias",
      title = "Mean Absolute Bias in Mean Estimates Main Loading 4")+
  theme_apa()
```




