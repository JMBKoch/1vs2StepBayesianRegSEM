---
title: "PLots MSE Mean Estimates SVNP"
author: "Koch, J.M.B. (Michael)"
date: '2022-05-02'
output: html_document
---

# Step1: Prepearations

```{r, message = F, warning = F}
# load packages outside of simulation
library(papaja)
library(patchwork)
#source required functions & parameters
source('~/OneDrive/ms/thesis/R/functions.R')
source('~/OneDrive/ms/thesis/R/parameters.R')
```

```{r}
# load results
resultsSVNP <- read.csv("~/OneDrive/ms/thesis/output/resultsSVNP.csv", 
                        sep = " ", 
                        header = TRUE)
convSVNP <- read.csv("~/OneDrive/ms/thesis/output/convSVNP.csv",
                     sep = " ",
                     header = TRUE)
```

# Post-process

```{r}
resultsSVNP <- 
  resultsSVNP %>% 
  arrange(sigma, N, cross, iteration) %>% 
  mutate(sigmaSqu = sigma^2,
         biasCrossMean_1 = abs(crossEstMean_1 - cross),
         biasCrossMean_2 = abs(crossEstMean_2 - 0),
         biasCrossMean_3 = abs(crossEstMean_3 - 0),
         biasCrossMean_4 = abs(crossEstMean_4 - 0),
         biasCrossMean_5 = abs(crossEstMean_5 - 0),
         biasCrossMean_6 = abs(crossEstMean_6 - cross),
         condID = rep(1:(nrow(condPop)*nrow(condSVNP)), each = nIter) 
) 
  
```



## Compute MSE

```{r}
mseMeanSVNP <- 
 resultsSVNP %>% 
  select(mainEstMean_1:mainEstMean_6,
        crossEstMean_1:crossEstMean_6,
        thetaEstMean_1:thetaEstMean_6,
        factCorrEstMean,
        cross,
        sigma, 
        sigmaSqu,
        N, 
        pos,
        iteration,
        condID) %>% 
    mutate(SquBiasEstMainMean_1 = (mainEstMean_1-modelPars$main)^2,
           SquBiasEstMainMean_2 = (mainEstMean_2-modelPars$main)^2,
           SquBiasEstMainMean_3 = (mainEstMean_3-modelPars$main)^2,
           SquBiasEstMainMean_4 = (mainEstMean_4-modelPars$main)^2,
           SquBiasEstMainMean_5 = (mainEstMean_5-modelPars$main)^2,
           SquBiasEstMainMean_6 = (mainEstMean_6-modelPars$main)^2,
           SquBiasEstCrossMean_1 = (crossEstMean_1-cross)^2,
           SquBiasEstCrossMean_2 = (crossEstMean_2-0)^2,
           SquBiasEstCrossMean_3 = (crossEstMean_3-0)^2,
           SquBiasEstCrossMean_4 = (crossEstMean_4-0)^2,
           SquBiasEstCrossMean_5 = (crossEstMean_5-0)^2,
           SquBiasEstCrossMean_6 = (crossEstMean_6-0)^2,
           SquBiasFactCorrEstMean = (factCorrEstMean-modelPars$Psi[1, 2])^2) %>% 
    group_by(as.factor(condID)) %>% 
      summarise(
        mseEstMainMean_1 = mean(SquBiasEstMainMean_1)/ nIter,
        mseEstMainMean_2 = mean(SquBiasEstMainMean_2) /nIter,
        mseEstMainMean_3 = mean(SquBiasEstMainMean_3) /nIter,
        mseEstMainMean_4 = mean(SquBiasEstMainMean_4) /nIter,
        mseEstMainMean_5 = mean(SquBiasEstMainMean_5) /nIter,
        mseEstMainMean_6 = mean(SquBiasEstMainMean_6) /nIter,
        mseEstCrossMean_1 = mean(SquBiasEstCrossMean_1)/nIter,
        mseEstCrossMean_2 = mean(SquBiasEstCrossMean_2)/nIter,
        mseEstCrossMean_3 = mean(SquBiasEstCrossMean_3)/nIter,
        mseEstCrossMean_4 = mean(SquBiasEstCrossMean_4)/nIter, 
        mseEstCrossMean_5 = mean(SquBiasEstCrossMean_5)/nIter,
        mseEstCrossMean_6 = mean(SquBiasEstCrossMean_6)/nIter, 
        mseFactCorrEstMean = mean(SquBiasFactCorrEstMean)/nIter,
        N = mean(N),
        cross = mean(cross),
        sigmaSqu = mean(sigmaSqu)
      ) %>% 
mseMeanSVNP
```



# Plots

## MSE mean estimates

### Cross-Loadings
```{r}
crossLoading1 <- 
mseMeanSVNP %>% 
  select(N, mseEstCrossMean_1, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(N, 
    cross, label) %>% 
  summarise(meanMseEstCrossMean_1 = mean(mseEstCrossMean_1)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMseEstCrossMean_1, group = label, col = label))+
  geom_point()+
  geom_line()+
  facet_wrap(~N)+
  labs(x = NULL,
      y = "MSE",
      title = "Cross-Loading 1")+
  theme_apa()
crossLoading1
```

```{r}
crossLoading2 <- 
mseMeanSVNP %>% 
  select(N, mseEstCrossMean_2, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(N, 
    cross, label) %>% 
  summarise(meanMseEstCrossMean_2 = mean(mseEstCrossMean_2)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMseEstCrossMean_2, group = label, col = label))+
  geom_point()+
  geom_line()+
  facet_wrap(~N)+
  labs(x = NULL,
      y = "MSE",
      title = "Cross-Loading 2")+
  theme_apa()
crossLoading2
```


```{r}
crossLoading3 <- 
mseMeanSVNP %>% 
  select(N, mseEstCrossMean_3, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(N, 
    cross, label) %>% 
  summarise(meanMseEstCrossMean_3 = mean(mseEstCrossMean_3)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMseEstCrossMean_3, group = label, col = label))+
  geom_point()+
  geom_line()+
  facet_wrap(~N)+
  labs(x = NULL,
      y = "MSE",
      title = "Cross-Loading 3")+
  theme_apa()
crossLoading3
```

```{r}
crossLoading4 <- 
mseMeanSVNP %>% 
  select(N, mseEstCrossMean_4, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(N, 
    cross, label) %>% 
  summarise(meanMseEstCrossMean_4 = mean(mseEstCrossMean_4)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMseEstCrossMean_4, group = label, col = label))+
  geom_point()+
  geom_line()+
  facet_wrap(~N)+
  labs(x = NULL,
      y = "MSE",
      title = "Cross-Loading 4")+
  theme_apa()
crossLoading4
```

```{r}
crossLoading5 <- 
mseMeanSVNP %>% 
  select(N, mseEstCrossMean_5, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(N, 
    cross, label) %>% 
  summarise(meanMseEstCrossMean_5 = mean(mseEstCrossMean_5)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMseEstCrossMean_5, group = label, col = label))+
  geom_point()+
  geom_line()+
  facet_wrap(~N)+
  labs(x = NULL,
      y = "MSE",
      title = "Cross-Loading 5")+
  theme_apa()
crossLoading5
```

```{r}
crossLoading5 <- 
mseMeanSVNP %>% 
  select(N, mseEstCrossMean_6, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(N, 
    cross, label) %>% 
  summarise(meanMseEstCrossMean_6 = mean(mseEstCrossMean_6)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMseEstCrossMean_6, group = label, col = label))+
  geom_point()+
  geom_line()+
  facet_wrap(~N)+
  labs(x = NULL,
      y = "MSE",
      title = "Cross-Loading 6")+
  theme_apa()
crossLoading6
```


```{r}
mseMeanSVNP %>% 
  select(crossEstMean_1:crossEstMean_6, sigma, cross) %>% 
  group_by(sigma, cross) %>% 
    summarise_all(mean)
```

### Factor Correlation


```{r}
factCorr <- 
mseMeanSVNP %>% 
  select(N, mseFactCorrEstMean, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(N, 
           cross, label) %>% 
  summarise(meanMseFactCorrEstMean = mean(mseFactCorrEstMean)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMseFactCorrEstMean, group = label, col = label))+
  geom_point()+
  geom_line()+
  facet_wrap(~N)+
  labs(x = "Size Cross Loading",
       y = "MSE",
      title = "Factor Correlation")+
  ylim(0, 0.5)+
  theme_apa()
factCorr
```

```{r}
png(file = "~/Downloads/factCorr.png", width=300, height=250)
factCorr + plot_layout(guides = "collect", ncol = 2) & theme(legend.position = "bottom", legend.title = element_blank())
dev.off()
```


### Main Loadings

```{r}
mainLoading1 <- 
mseMeanSVNP %>% 
  select(N, mseEstMainMean_1, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(N, 
           cross, label) %>% 
  summarise(meanMseEstMainMean_1 = mean(mseEstMainMean_1)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMseEstMainMean_1, group = label, col = label))+
  geom_point()+
  geom_line()+
  facet_wrap(~N)+
  labs(x = NULL,
       y = "MSE",
      title = "Main Loading 1")+
  theme_apa()
mainLoading1
```


```{r}
mainLoading2 <- 
mseMeanSVNP %>% 
  select(N, mseEstMainMean_2, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(N, 
           cross, label) %>% 
  summarise(meanMseEstMainMean_2 = mean(mseEstMainMean_2)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMseEstMainMean_2, group = label, col = label))+
  geom_point()+
  geom_line()+
  facet_wrap(~N)+
  labs(x = NULL,
       y = "MSE",
      title = "Main Loading 2")+
  theme_apa()
mainLoading2
```

```{r}
mainLoading3 <- 
mseMeanSVNP %>% 
  select(N, mseEstMainMean_3, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(N, 
           cross, label) %>% 
  summarise(meanMseEstMainMean_3 = mean(mseEstMainMean_3)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMseEstMainMean_3, group = label, col = label))+
  geom_point()+
  geom_line()+
  facet_wrap(~N)+
  labs(x = NULL,
       y = "MSE",
      title = "Main Loading 3")+
  theme_apa()
mainLoading3
```


```{r}
mainLoading4 <- 
mseMeanSVNP %>% 
  select(N, mseEstMainMean_4, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(N, 
           cross, label) %>% 
  summarise(meanMseEstMainMean_4 = mean(mseEstMainMean_4)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMseEstMainMean_4, group = label, col = label))+
  geom_point()+
  geom_line()+
  facet_wrap(~N)+
  labs(x = NULL,
       y = "MSE",
      title = "Main Loading 4")+
  theme_apa()
mainLoading4
```

```{r}
mainLoading5 <- 
mseMeanSVNP %>% 
  select(N, mseEstMainMean_5, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(N, 
           cross, label) %>% 
  summarise(meanMseEstMainMean_5 = mean(mseEstMainMean_5)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMseEstMainMean_5, group = label, col = label))+
  geom_point()+
  geom_line()+
  facet_wrap(~N)+
  labs(x = NULL,
       y = "MSE",
      title = "Main Loading 5")+
  theme_apa()
mainLoading5
```

```{r}
mainLoading6 <- 
mseMeanSVNP %>% 
  select(N, mseEstMainMean_6, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(N, 
           cross, label) %>% 
  summarise(meanMseEstMainMean_6 = mean(mseEstMainMean_6)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMseEstMainMean_6, group = label, col = label))+
  geom_point()+
  geom_line()+
  facet_wrap(~N)+
  labs(x = NULL,
       y = "MSE",
      title = "Main Loading 6")+
  theme_apa()
mainLoading6
```


### Residual Variances

```{r}
theta1 <- 
mseMeanSVNP %>% 
  select(N, mseEst, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(N, 
           cross, label) %>% 
  summarise(meanMseEstMainMean_5 = mean(mseEstMainMean_5)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMseEstMainMean_5, group = label, col = label))+
  geom_point()+
  geom_line()+
  facet_wrap(~N)+
  labs(x = NULL,
       y = "MSE",
      title = "Main Loading 5")+
  theme_apa()
mainLoading5
```

