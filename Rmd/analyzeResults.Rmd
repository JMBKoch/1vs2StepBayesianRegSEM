---
title: "Analyzing the results" 
author: "Michael Koch"
date: "07-03-2022"
output: html_document
---

# Working through the results of the Mini- (/ Pilot-) simulation for the SVNP

## Step1: Prepearations

```{r, message = F}
#source required functions & parameters
source('~/1vs2StepBayesianRegSEM/R/functions.R')
source('~/1vs2StepBayesianRegSEM/R/parameters.R')
```

```{r}
# load results
resultsSVNP <- read.csv("~/1vs2StepBayesianRegSEM/output/backupResults/18.3/resultsSVNP.csv", 
                        sep = " ", 
                        header = TRUE)
convSVNP <- read.csv("~/1vs2StepBayesianRegSEM/output/backupResults/18.3/convSVNP.csv",
                     sep = " ",
                     header = TRUE)
```

```{r, chache=T}
# inspect both a bit
head(resultsSVNP)
head(convSVNP)
```

## Select only converged rows of the results

```{r}
#resultsTrimmed <- selectConv(resultsSVNP)
resultsTrimmed <- resultsSVNP # voor nu ff convergence negeren, wordt belangrijk met RHSP
```

## Compute output object based on the converged results

```{r}
outcomes <- computeOutcomes(resultsTrimmed, modelPars)
# compute a sigma squared col (more informatie/ intuitive than the sigmas)
outcomes$sigmaSqu = outcomes$sigma^2
```

```{r}
head(outcomes)
```


# Tabels


## Bias Mean Estimates

### Factor Correlation

```{r}
t1 <- 
resultsTrimmed %>% 
  select(biasFactCorrMean, cross) %>%
  group_by(cross) %>% 
  summarise(`Mean Bias in Mean Estimates Factor Correlation` = mean(biasFactCorrMean))
```


```{r}
papaja::apa_table(t1)
```

# Plots


## Bias Mean Estimates `

### Factor Correlation

```{r}
resultsTrimmed %>% 
  select(biasFactCorrMean, cross) %>%
  group_by(cross) %>% 
  summarise(meanBiasFactCorrMean = mean(biasFactCorrMean)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasFactCorrMean))+
  geom_point(shape = 3)+
  theme_light()+
  labs(x = "Size Cross Loadings",
       y = "Mean Bias",
       title = "Mean Bias in Mean Estimates Factor Correlation")
```

```{r}
resultsTrimmed %>% 
  select(biasFactCorrMean, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(cross, label) %>% 
  summarise(meanBiasFactCorrMean = mean(biasFactCorrMean)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasFactCorrMean))+
  geom_point(shape = 3)+
  facet_wrap(~label)+
  labs(x = "Size Cross Loading",
       y = "Mean Bias",
      title = "Mean Bias in Mean Estimates Factor Correlation")+
  theme_light()
```


### Main Loadings

```{r}
resultsTrimmed %>% 
  select(biasMainMean_1:biasMainMean_6, cross) %>%
  mutate(biasMainMeanPooled = (biasMainMean_1+biasMainMean_2+biasMainMean_3+biasMainMean_4+biasMainMean_5+biasMainMean_6)/6) %>% 
  group_by(as.factor(cross)) %>% 
  summarise(meanBiasMainMeanPooled = mean(biasMainMeanPooled)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasMainMeanPooled))+
  geom_point(shape = 3)+
  theme_light()+
  labs(x = "Size Cross Loading",
       y = "Pooled Mean Bias",
       title = "Mean (pooled) Bias in Mean Estimates Main Loadings" )
```

### Cross-Loadings

```{r}
resultsTrimmed %>% 
  select(biasCrossMean_1:biasCrossMean_6, cross) %>%
  mutate(biasCrossMeanPooled = (biasCrossMean_1 + biasCrossMean_2+biasCrossMean_3+biasCrossMean_4+biasCrossMean_5+biasCrossMean_6)/6) %>% 
  group_by(as.factor(cross)) %>% 
  summarise(meanBiasCrossMeanPooled = mean(biasCrossMeanPooled)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasCrossMeanPooled))+
  geom_point(shape = 3)+
  theme_light()+
  labs(x = "Size Cross Loading",
       y = "Pooled Mean Bias",
       title = "Mean (pooled) Bias in Mean Estimates Cross Loadings" )
```


## Bias Median Estimates

### Factor Correlation

```{r}
outcomes %>% 
  select(biasFactCorrMed, cross) %>%
  group_by(cross) %>% 
  summarise(meanBiasFactCorrMed = mean(biasFactCorrMed)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasFactCorrMed))+
  geom_point(shape = 3)+
  theme_light()+
  labs(x = "Size Cross Loadings",
       y = "Mean Bias",
       title = "Mean Bias in Median Estimates Factor Correlation")
```

```{r}
outcomes %>% 
  select(biasFactCorrMed, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(cross, label) %>% 
  summarise(meanBiasFactCorrMed = mean(biasFactCorrMed)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasFactCorrMed))+
  geom_point(shape = 3)+
  facet_wrap(~label)+
  labs(x = "Size Cross Loading",
       y = "Mean Bias",
      title = "Mean Bias in Median Estimates Factor Correlation")+
  theme_light()
```

### Main Loadings

```{r}
outcomes %>% 
  select(biasMainMed_1:biasMainMed_6, cross) %>%
  mutate(biasMainMedPooled = (biasMainMed_1+biasMainMed_2+biasMainMed_3+biasMainMed_4+biasMainMed_5+biasMainMed_6)/6) %>% 
  group_by(as.factor(cross)) %>% 
  summarise(meanBiasMainMedPooled = mean(biasMainMedPooled)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasMainMedPooled))+
  geom_point(shape = 3)+
  theme_light()+
  labs(x = "Size Cross Loading",
       y = "Pooled Mean Bias",
       title = "Mean (pooled) Bias in Median Estimates Main Loadings" )
```


### Cross-Loadings

```{r}
outcomes %>% 
  select(biasCrossMed_1:biasCrossMed_6, cross) %>%
  mutate(biasCrossMedPooled = (biasCrossMed_1 + biasCrossMed_2+biasCrossMed_3+biasCrossMed_4+biasCrossMed_5+biasCrossMed_6)/6) %>% 
  group_by(as.factor(cross)) %>% 
  summarise(meanBiasCrossMedPooled = mean(biasCrossMedPooled)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanBiasCrossMedPooled))+
  geom_point(shape = 3)+
  theme_light()+
  labs(x = "Size Cross Loading",
       y = "Pooled Mean Bias",
       title = "Mean (pooled) Bias in Median Estimates Cross Loadings" )
```



## MSE Mean Estimates

### Factor Correlation

```{r}
outcomes %>% 
  select(mseFactCorrMean, cross) %>%
  group_by(cross) %>% 
  summarise(meanMSEFactCorrMean = mean(mseFactCorrMean)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMSEFactCorrMean))+
  geom_point(shape = 3)+
  theme_light()+
  labs(x = "Size Cross Loadings",
       y = "Mean MSE",
       title = "Mean MSE in Mean Estimates Factor Correlation")
```
```{r}
outcomes %>% 
  select(mseFactCorrMean, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(cross, label) %>% 
  summarise(meanMSEFactCorrMean = mean(mseFactCorrMean)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMSEFactCorrMean))+
  geom_point(shape = 3)+
  facet_wrap(~label)+
  labs(x = "Size Cross Loading",
       y = "Mean MSE",
      title = "Mean MSE in Mean Estimates Factor Correlation")+
  theme_light()
```


### Main Loadings

```{r}
outcomes %>% 
  select(mseMainMean_1:mseMainMean_6, cross) %>%
  mutate(mseMainMeanPooled = (mseMainMean_1+mseMainMean_2+mseMainMean_3+mseMainMean_4+mseMainMean_5+mseMainMean_6)/6) %>% 
  group_by(as.factor(cross)) %>% 
  summarise(meanMSEMainMeanPooled = mean(mseMainMeanPooled)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMSEMainMeanPooled))+
  geom_point(shape = 3)+
  theme_light()+
  labs(x = "Size Cross Loading",
       y = "Pooled Mean MSE",
       title = "Mean (pooled) Bias MSE in Mean Estimates Main Loadings" )
```

### Cross-Loadings

```{r}
outcomes %>% 
  select(mseCrossMean_1:mseCrossMean_6, cross) %>%
  mutate(mseCrossMeanPooled = (mseCrossMean_1 + mseCrossMean_2 + mseCrossMean_3+mseCrossMean_4+mseCrossMean_5+mseCrossMean_6)/6) %>% 
  group_by(as.factor(cross)) %>% 
  summarise(meanMSECrossMeanPooled = mean(mseCrossMeanPooled)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMSECrossMeanPooled))+
  geom_point(shape = 3)+
  theme_light()+
  labs(x = "Size Cross Loading",
       y = "Pooled Mean MSE",
       title = "Mean (pooled) MSE in Mean Estimates Cross Loadings" )
```


## MSE Median Estimates

### Factor Correlation

```{r}
outcomes %>% 
  select(mseFactCorrMed, cross) %>%
  group_by(cross) %>% 
  summarise(meanMSEFactCorrMed = mean(mseFactCorrMed)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMSEFactCorrMed))+
  geom_point(shape = 3)+
  theme_light()+
  labs(x = "Size Cross Loadings",
       y = "Mean MSE",
       title = "Mean MSE in Median Estimates Factor Correlation")
```
```{r}
outcomes %>% 
  select(mseFactCorrMed, cross, sigmaSqu) %>%
  mutate(label = as.factor(paste0("\u03c3\u00B2 = ", sigmaSqu))) %>% 
  group_by(cross, label) %>% 
  summarise(meanMSEFactCorrMed = mean(mseFactCorrMed)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMSEFactCorrMed))+
  geom_point(shape = 3)+
  facet_wrap(~label)+
  labs(x = "Size Cross Loading",
       y = "Mean MSE",
      title = "Mean MSE in Median Estimates Factor Correlation")+
  theme_light()
```


### Main Loadings

```{r}
outcomes %>% 
  select(mseMainMed_1:mseMainMed_6, cross) %>%
  mutate(mseMainMedPooled = (mseMainMed_1+mseMainMed_2+mseMainMed_3+mseMainMed_4+mseMainMed_5+mseMainMed_6)/6) %>% 
  group_by(as.factor(cross)) %>% 
  summarise(meanMSEMainMedPooled = mean(mseMainMedPooled)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMSEMainMedPooled))+
  geom_point(shape = 3)+
  theme_light()+
  labs(x = "Size Cross Loading",
       y = "Pooled Mean MSE",
       title = "Mean (pooled) Bias MSE in Median Estimates Main Loadings" )
```


### Cross-Loadings

```{r}
outcomes %>% 
  select(mseCrossMed_1:mseCrossMed_6, cross) %>%
  mutate(mseCrossMedPooled = (mseCrossMed_1 + mseCrossMed_2 + mseCrossMed_3+mseCrossMed_4+mseCrossMed_5+mseCrossMed_6)/6) %>% 
  group_by(as.factor(cross)) %>% 
  summarise(meanMSECrossMedPooled = mean(mseCrossMedPooled)) %>% 
  ggplot(aes(x = as.factor(cross), y = meanMSECrossMedPooled))+
  geom_point(shape = 3)+
  theme_light()+
  labs(x = "Size Cross Loading",
       y = "Pooled Mean MSE",
       title = "Mean (pooled) MSE in Median Estimates Cross Loadings" )
```



# Quantile Plots

```{r}
quantilesWide <- select(resultsTrimmed, X2.5._1:X90._6)
quantilesLong <- 
  intervalsWide %>% 
  pivot_longer(everything(), 
               names_to = c("quantile", "item"),
               names_sep = "_")
```

```{r}
#quantilesLong %>% 
#  group_by(item) %>% 
#  select()
#  filter(c(X2.5.))
```

